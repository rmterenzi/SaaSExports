///$tab Main
//Binary [e:\apps\financial analysis\financial analysisv8.qvw];
//

//store * from AccMaster into AccMaster.qvd;
//store * from FinalAccBalances into FinalAccBalances.qvd;
//store * from FinalYTDMTD into FinalYTDMTD.qvd;
//store * from AccountDetail into AccountDetail.qvd;
//store * from QuickRatioYTD into QuickRatioYTD.qvd;
//store * from QuickRatio into QuickRatio.qvd;
//store * from CurrentRatioYTD into CurrentRatioYTD.qvd;
//store * from ROAYTD into ROAYTD.qvd;
//store * from NPARYTD into NPARYTD.qvd;
//store * from DebtToEquityYTD into DebtToEquityYTD.qvd;
//store * from STAYTD into STAYTD.qvd;
//store * from ROEYTD into ROEYTD.qvd;
//store * from FiveMjrAccGrp3 into FiveMjrAccGrp3.qvd;
//store * from FourMjrAccGrp3 into FourMjrAccGrp3.qvd;
//store * from MjrAccGrp3 into MjrAccGrp3.qvd;
//store * from EBITDAYTD into EBITDAYTD.qvd;
//store * from FinalAccTrialBalances into FinalAccTrialBalances.qvd;
//store * from PLMatch into PLMatch.qvd;
//store * from CFMatch into CFMatch.qvd;
//store * from [MjrAccGrp3-1] into [MjrAccGrp3-1].qvd;
//store * from [PLMatch-1] into [PLMatch-1].qvd;
//store * from [FourMjrAccGrp3-1] into [FourMjrAccGrp3-1].qvd;
//store * from [FiveMjrAccGrp3-1] into [FiveMjrAccGrp3-1].qvd;
//store * from [QuickRatio] into [QuickRatio].qvd;
//store * from [CFMatch-1] into [CFMatch-1].qvd;
//store * from DebtToEquity into DebtToEquity.qvd;
//store * from CurrentRatio into CurrentRatio.qvd;
//store * from ROE into ROE.qvd;
//store * from NPAR into NPAR.qvd;
//store * from STA into STA.qvd;
//store * from ROA into ROA.qvd;
//store * from [RptCode2-1] into [RptCode2-1].qvd;
//store * from INL10F into INL10F.qvd;
//store * from AccountSubType into AccountSubType.qvd;
//store * from EBITDA into EBITDA.qvd;
//store * from RptCode1 into RptCode1.qvd;
//store * from RptCode2 into RptCode2.qvd;


//Load the binary above.
//after the binary is loaded you can call the QV api and read the tables
////this will not work on some files if some security switchs are set like the demo's we provide
//
//LET tblCnt = TblCnt();
//LET tblToQVD = GetTableName(0);
//
//store * from [$(tblToQVD)] into $(tblToQVD).QVD;
//
//for i = 1 to $(tblCnt) - 1
//	LET tblToQVD = GetTableName(i);
//	store * from [$(tblToQVD)] into [data\$(tblToQVD).QVD];
//next
//
//directory;

//load * from AccMaster.qvd;
//Directory;


//Time offsets Wade Manis
let yearOffset = year(today())-2008;  //2003 is the max year here
 


AccMaster:
LOAD [Reporting Code 5],
	[Reporting Code 4],
	AccountMasterKey,
	[Account ID],
	[Account Description],
	[Account Type],
	[Account Sub Type],
	[Account Number],
	Subsidiary,
	Company,
	GMMCU,
	GMPEC,
	[Account Level],
	[Reporting Code 1],
	[Reporting Code 2],
	[Reporting Code 3],
	[Reporting Code 6],
	[Reporting Code 7],
	[Reporting Code 8],
	[Reporting Code 9],
	[Reporting Code 10],
	[Reporting Code 11],
	[Reporting Code 12],
	[Reporting Code 13],
	[Reporting Code 14],
	[Reporting Code 15],
	[Reporting Code 4 Num],
	[Reporting Code 5 Num]
FROM data\AccMaster.QVD (qvd);
///$tab FinalAcctBalances
FinalAccBalances:
LOAD CompanyYearKey,
	AccountMasterKey,
	BalanceDetailKey,
	AggKey,
	TrialBalanceKey,
	Century,
	GBCO,
	[Fiscal Year]+$(yearOffset) as [Fiscal Year], //wms
	[Ledger Type],
	Month,
	ceil(MonthNum/3) as Quarter, //WMS
	MonthNum,
	YearMonth as OriginalYearMonth,
	//YearMonth,
	date(monthend(makedate([Fiscal Year]+$(yearOffset),MonthNum,1)),'MMM-YY') as YearMonth,
	//dual(Month&'-'& right(([Fiscal Year]+$(yearOffset)),2),makedate(Month&'-'& right(([Fiscal Year]+$(yearOffset)),2)))as YearMonth, //wms
	[Fiscal Year]+$(yearOffset)&MonthNum as YearMonthNum, //wms
	//YearMonthNum,
	CurrentFiscalYear+$(yearOffset) as CurrentFiscalYear,
	CurrentFiscalMonth,
	CurrentFiscalYearMonth,
	[Period Open/Closed],
	Amount,
	[Budget Amount]
FROM data\FinalAccBalances.QVD (qvd);

///$tab FinalYTDMTD
FinalYTDMTD:
Directory;
LOAD AggKey,
	[YTD Amount],
	[LY YTD Amount],
	[MTD Amount],
	[LY MTD Amount],
	[Previous Month MTD Amount],
	[Previous Month LY MTD Amount],
	[YTD Budget Amount],
	[MTD Budget Amount],
	[Previous Month MTD Budget Amount]
FROM data\FinalYTDMTD.QVD (qvd);


//load * from .qvd;

AccountDetail:
LOAD BalanceDetailKey,
	[Voucher Number],
	[G/L Date] as originalGLDate, //wms
	setDateYear(Date([G/L Date],'m/d/yyyy'), year([G/L Date])+$(yearOffset)) AS [G/L Date], //wms 
	[Transaction Amount],
	[Voucher Description],
	[Voucher Remark],
	SubLedger,
	[SubLedger Type]
FROM data\AccountDetail.QVD (qvd);


QuickRatioYTD:
LOAD Company,
	[QRATIO - YTD Current Assets Amount],
	[QRATIO - YTD Current Liabilities Amount],
	[QRATIO - LY YTD Current Assets Amount],
	[QRATIO - LY YTD Current Liabilities Amount],
	[QRATIO - PM YTD Current Assets Amount],
	[QRATIO - PM YTD Current Liabilities Amount]
FROM data\QuickRatioYTD.QVD (qvd);



QuickRatio:
LOAD CompanyYearKey,
	[QRATIO - Current Assets Amount],
	[QRATIO - Current Liabilities Amount]
FROM data\QuickRatio.QVD (qvd);



CurrentRatioYTD:
LOAD Company,
	[CRATIO - YTD Current Assets Amount],
	[CRATIO - YTD Current Liabilities Amount],
	[CRATIO - LY YTD Current Assets Amount],
	[CRATIO - LY YTD Current Liabilities Amount],
	[CRATIO - PM YTD Current Assets Amount],
	[CRATIO - PM YTD Current Liabilities Amount]
FROM data\CurrentRatioYTD.QVD (qvd);


ROAYTD:
LOAD Company,
	[ROA - YTD Net Income Amount],
	[ROA - YTD Assets Amount],
	[ROA - LY YTD Net Income Amount],
	[ROA - LY YTD Assets Amount],
	[ROA - PM YTD Net Income Amount],
	[ROA - PM YTD Assets Amount]
FROM data\ROAYTD.QVD (qvd);


NPARYTD:
LOAD Company,
	[NPAR - YTD Notes Payable Amount],
	[NPAR - YTD Accounts Receivables Amount],
	[NPAR - LY YTD Notes Payable Amount],
	[NPAR - LY YTD Accounts Receivables Amount],
	[NPAR - PM YTD Notes Payable Amount],
	[NPAR - PM YTD Accounts Receivables Amount]
FROM data\NPARYTD.QVD (qvd);


DebtToEquityYTD:
LOAD Company,
	[D/E - YTD Liabilities Amount],
	[D/E - YTD Equity Amount],
	[D/E - LY YTD Liabilities Amount],
	[D/E - LY YTD Equity Amount],
	[D/E - PM YTD Liabilities Amount],
	[D/E - PM YTD Equity Amount]
FROM data\DebtToEquityYTD.QVD (qvd);



STAYTD:
LOAD Company,
	[STA - YTD Sales Amount],
	[STA - YTD Assets Amount],
	[STA - LY YTD Sales Amount],
	[STA - LY YTD Assets Amount],
	[STA - PM YTD Sales Amount],
	[STA - PM YTD Assets Amount]
FROM data\STAYTD.QVD (qvd);


ROEYTD:
LOAD Company,
	[ROE - YTD Net Income Amount],
	[ROE - YTD Equity Amount],
	[ROE - LY YTD Net Income Amount],
	[ROE - LY YTD Equity Amount],
	[ROE - PM YTD Net Income Amount],
	[ROE - PM YTD Equity Amount]
FROM data\ROEYTD.QVD (qvd);




FiveMjrAccGrp3:
LOAD [5 Sub Major Account Number],
	[5 Sub Major Account Description],
	StartNo5,
	EndNo5
FROM data\FiveMjrAccGrp3.QVD (qvd);


FourMjrAccGrp3:
LOAD [Sub Major Account Number],
	[Sub Major Account Description],
	StartNo4,
	EndNo4
FROM data\FourMjrAccGrp3.QVD (qvd);


MjrAccGrp3:
LOAD [Major Account Number],
	[Major Account Description],
	StartNo,
	EndNo
FROM data\MjrAccGrp3.QVD (qvd);


EBITDAYTD:
LOAD Company,
	[EBITDA - YTD Amount],
	[EBITDA - LY YTD Amount],
	[EBITDA - PM YTD Amount]
FROM data\EBITDAYTD.QVD (qvd);



FinalAccTrialBalances:
LOAD TrialBalanceKey,
	[Opening Balance Amount],
	[Closing Balance Amount],
	[Trial Balance Amount]
FROM data\FinalAccTrialBalances.QVD (qvd);


PLMatch:
LOAD [P&L Level],
	[P&L Heading],
	PLStart,
	PLEnd
FROM data\PLMatch.QVD (qvd);


CFMatch:
LOAD [Cash Flow Level],
	[Cash Flow Heading],
	CFStart,
	CFEnd
FROM data\CFMatch.QVD (qvd);


[MjrAccGrp3-1]:
LOAD [Account Number],
	StartNo,
	EndNo
FROM [data\MjrAccGrp3-1.QVD] (qvd);



[PLMatch-1]:
LOAD [Reporting Code 4 Num],
	PLStart,
	PLEnd
FROM [data\PLMatch-1.QVD] (qvd);


[FourMjrAccGrp3-1]:
LOAD [Account Number],
	StartNo4,
	EndNo4
FROM [data\FourMjrAccGrp3-1.QVD] (qvd);


[FiveMjrAccGrp3-1]:
LOAD [Account Number],
	StartNo5,
	EndNo5
FROM [data\FiveMjrAccGrp3-1.QVD] (qvd);


[QuickRatio]:
LOAD CompanyYearKey,
	[QRATIO - Current Assets Amount],
	[QRATIO - Current Liabilities Amount]
FROM data\QuickRatio.QVD (qvd);


[CFMatch-1]:
LOAD [Reporting Code 5 Num],
	CFStart,
	CFEnd
FROM [data\CFMatch-1.QVD] (qvd);


DebtToEquity:
LOAD CompanyYearKey,
	[D/E - Liabilities Amount],
	[D/E - Equity Amount]
FROM data\DebtToEquity.QVD (qvd);


CurrentRatio:
LOAD CompanyYearKey,
	[CRATIO - Current Assets Amount],
	[CRATIO - Current Liabilities Amount]
FROM data\CurrentRatio.QVD (qvd);


ROE:
LOAD CompanyYearKey,
	[ROE - Net Income Amount],
	[ROE - Equity Amount]
FROM data\ROE.QVD (qvd);


NPAR:
LOAD CompanyYearKey,
	[NPAR - Notes Payable Amount],
	[NPAR - Accounts Receviables Amount]
FROM data\NPAR.QVD (qvd);


STA:
LOAD CompanyYearKey,
	[STA - Sales Amount],
	[STA - Assets Amount]
FROM data\STA.QVD (qvd);


ROA:
LOAD CompanyYearKey,
	[ROA - Net Income Amount],
	[ROA - Assets Amount]
FROM data\ROA.QVD (qvd);


[RptCode2-1]:
LOAD Name,
	[Email Address]
FROM [data\RptCode2-1.QVD] (qvd);


INL10F:
LOAD GMMCU,
	[Business Unit]
FROM data\INL10F.QVD (qvd);


AccountSubType:
LOAD [Account Sub Type],
	[Account Sub Type Description]
FROM data\AccountSubType.QVD (qvd);


EBITDA:
LOAD CompanyYearKey,
	[EBITDA - Amount]
FROM data\EBITDA.QVD (qvd);


RptCode1:
LOAD [Reporting Code 1 Description],
	[Reporting Code 1]
FROM data\RptCode1.QVD (qvd);


RptCode2:
Directory;
LOAD [Reporting Code 2 Description],
	[Reporting Code 2]
FROM data\RptCode2.QVD (qvd);

