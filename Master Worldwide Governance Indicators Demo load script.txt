///$tab Main
SET ThousandSep=',';
SET DecimalSep='.';
SET MoneyThousandSep=',';
SET MoneyDecimalSep='.';
SET MoneyFormat='$#,##0.00;-$#,##0.00';
SET TimeFormat='hh:mm:ss';
SET DateFormat='MM/DD/YYYY';
SET TimestampFormat='MM/DD/YYYY hh:mm:ss[.fff]';
SET MonthNames='Jan;Feb;Mar;Apr;May;Jun;Jul;Aug;Sep;Oct;Nov;Dec';
SET DayNames='Mon;Tue;Wed;Thu;Fri;Sat;Sun';
SET LongMonthNames='January;February;March;April;May;June;July;August;September;October;November;December';
SET LongDayNames='Monday;Tuesday;Wednesday;Thursday;Friday;Saturday;Sunday';
SET FirstWeekDay=0;
SET BrokenWeeks=1;
SET ReferenceDay=0;
SET FirstMonthOfYear=1;
SET CollationLocale='en-GB';







///$tab General
OPPR_ALL_DTL_GNRL_12192014:
LOAD
    General_Transaction_ID,
    Program_Year,
    Payment_Publication_Date,
    Submitting_Applicable_Manufacturer_or_Applicable_GPO_Name,
    Covered_Recipient_Type,
    Teaching_Hospital_ID,
    Teaching_Hospital_Name,
    Physician_Profile_ID,
    Physician_First_Name,
    Physician_Middle_Name,
    Physician_Last_Name,
    Physician_First_Name &' '& Physician_Middle_Name & ' ' &  Physician_Last_Name    as 'Physician_Full_Name',
    Physician_Name_Suffix,
    Recipient_Primary_Business_Street_Address_Line1,
    Recipient_Primary_Business_Street_Address_Line2,
    Recipient_City,
    Recipient_State,
    Recipient_Zip_Code,
    Recipient_Country,
    Recipient_Province,
    Recipient_Postal_Code,
    Physician_Primary_Type,
    Physician_Specialty,
    Physician_License_State_code1,
    Physician_License_State_code2,
    Physician_License_State_code3,
    Physician_License_State_code4,
    Physician_License_State_code5,
    Product_Indicator,
    Name_of_Associated_Covered_Drug_or_Biological1,
    Name_of_Associated_Covered_Drug_or_Biological2,
    Name_of_Associated_Covered_Drug_or_Biological3,
    Name_of_Associated_Covered_Drug_or_Biological4,
    Name_of_Associated_Covered_Drug_or_Biological5,
    NDC_of_Associated_Covered_Drug_or_Biological1,
    NDC_of_Associated_Covered_Drug_or_Biological2,
    NDC_of_Associated_Covered_Drug_or_Biological3,
    NDC_of_Associated_Covered_Drug_or_Biological4,
    NDC_of_Associated_Covered_Drug_or_Biological5,
    Name_of_Associated_Covered_Device_or_Medical_Supply1,
    Name_of_Associated_Covered_Device_or_Medical_Supply2,
    Name_of_Associated_Covered_Device_or_Medical_Supply3,
    Name_of_Associated_Covered_Device_or_Medical_Supply4,
    Name_of_Associated_Covered_Device_or_Medical_Supply5,
    Applicable_Manufacturer_or_Applicable_GPO_Making_Payment_Name,
    Applicable_Manufacturer_or_Applicable_GPO_Making_Payment_ID,
    Applicable_Manufacturer_or_Applicable_GPO_Making_Payment_State,
    Applicable_Manufacturer_or_Applicable_GPO_Making_Payment_Country,
    Dispute_Status_for_Publication,
    Total_Amount_of_Payment_USDollars,
    Date_of_Payment,
    Number_of_Payments_Included_in_Total_Amount,
    Form_of_Payment_or_Transfer_of_Value,
    Nature_of_Payment_or_Transfer_of_Value,
    City_of_Travel,
    State_of_Travel,
    Country_of_Travel,
    Physician_Ownership_Indicator,
    Third_Party_Payment_Recipient_Indicator,
    Name_of_Third_Party_Entity_Receiving_Payment_or_Transfer_of_Value,
    Charity_Indicator,
    Third_Party_Equals_Covered_Recipient_Indicator,
    Contextual_Information,
    Delay_in_Publication_of_General_Payment_Indicator
FROM [lib://CMS/OPPR_ALL_DTL_GNRL_12192014.csv]
(txt, codepage is 1252, embedded labels, delimiter is ',', msq);
///$tab us_states.kml
[US-States.shp/Features]:
LOAD
    "US States.Name" as "Recipient_State",
    "US States.Point",
    "US States.Area"
FROM [lib://Maps/US States.kml]
(kml, Table is [US-States.shp/Features]);




///$tab Ownership
Qualify *;
Unqualify 'Physician_Profile_ID';

Ownership:
LOAD
    Physician_Ownership_Transaction_ID,
    Program_Year,
    Payment_Publication_Date,
    Submitting_Applicable_Manufacturer_or_Applicable_GPO_Name,
    Physician_Profile_ID,
    Physician_First_Name,
    Physician_Middle_Name,
    Physician_Last_Name,
    Physician_Name_Suffix,
    Recipient_Primary_Business_Street_Address_Line1,
    Recipient_Primary_Business_Street_Address_Line2,
    Recipient_City,
    Recipient_State,
    Recipient_Zip_Code,
    Recipient_Country,
    Recipient_Province,
    Recipient_Postal_Code,
    Physician_Primary_Type,
    Physician_Specialty,
    Applicable_Manufacturer_or_Applicable_GPO_Making_Payment_Name,
    Applicable_Manufacturer_or_Applicable_GPO_Making_Payment_ID,
    Applicable_Manufacturer_or_Applicable_GPO_Making_Payment_State,
    Applicable_Manufacturer_or_Applicable_GPO_Making_Payment_Country,
    Dispute_Status_for_Publication,
    Interest_Held_by_Physician_or_an_Immediate_Family_Member,
    Dollar_Amount_Invested,
    Value_of_Interest,
    Terms_of_Interest
FROM [lib://CMS/OPPR_ALL_DTL_OWNRSHP_12192014.csv]
(txt, codepage is 1252, embedded labels, delimiter is ',', msq);


///$tab Research
Qualify *;
Unqualify 'Physician_Profile_ID';
Unqualify 'Teaching_Hospital_ID';

Research:
LOAD
    Research_Transaction_ID,
    Program_Year,
    Payment_Publication_Date,
    Submitting_Applicable_Manufacturer_or_Applicable_GPO_Name,
    Covered_Recipient_Type,
    Noncovered_Recipient_Entity_Name,
    Teaching_Hospital_ID,
    Teaching_Hospital_Name,
    Physician_Profile_ID,
    Physician_First_Name,
    Physician_Middle_Name,
    Physician_Last_Name,
    Physician_Name_Suffix,
    Recipient_Primary_Business_Street_Address_Line1,
    Recipient_Primary_Business_Street_Address_Line2,
    Recipient_City,
    Recipient_State,
    Recipient_Zip_Code,
    Recipient_Country,
    Recipient_Province,
    Recipient_Postal_Code,
    Physician_Primary_Type,
    Physician_Specialty,
    Physician_License_State_code1,
    Physician_License_State_code2,
    Physician_License_State_code3,
    Physician_License_State_code4,
    Physician_License_State_code5,
    Product_Indicator,
    Name_of_Associated_Drug_or_Biological1,
    Name_of_Associated_Drug_or_Biological2,
    Name_of_Associated_Drug_or_Biological3,
    Name_of_Associated_Drug_or_Biological4,
    Name_of_Associated_Drug_or_Biological5,
    NDC_of_Associated_Covered_Drug_or_Biological1,
    NDC_of_Associated_Covered_Drug_or_Biological2,
    NDC_of_Associated_Covered_Drug_or_Biological3,
    NDC_of_Associated_Covered_Drug_or_Biological4,
    NDC_of_Associated_Covered_Drug_or_Biological5,
    Name_of_Associated_Covered_Device_or_Medical_Supply1,
    Name_of_Associated_Covered_Device_or_Medical_Supply2,
    Name_of_Associated_Covered_Device_or_Medical_Supply3,
    Name_of_Associated_Covered_Device_or_Medical_Supply4,
    Name_of_Associated_Covered_Device_or_Medical_Supply5,
    Applicable_Manufacturer_or_Applicable_GPO_Making_Payment_ID,
    Applicable_Manufacturer_or_Applicable_GPO_Making_Payment_Name,
    Applicable_Manufacturer_or_Applicable_GPO_Making_Payment_State,
    Applicable_Manufacturer_or_Applicable_GPO_Making_Payment_Country,
    Dispute_Status_for_Publication,
    Total_Amount_of_Payment_USDollars,
    Date_of_Payment,
    Form_of_Payment_or_Transfer_of_Value,
    Expenditure_Category1,
    Expenditure_Category2,
    Expenditure_Category3,
    Expenditure_Category4,
    Expenditure_Category5,
    Preclinical_Research_Indicator,
    Delay_in_Publication_of_Research_Payment_Indicator,
    Name_of_Study,
    Principal_Investigator_Name1,
    Principal_Investigator_Name2,
    Principal_Investigator_Name3,
    Principal_Investigator_Name4,
    Principal_Investigator_Name5,
    ClinicalTrials_Gov_Identifier,
    Research_Information_Link,
    Context_of_Research
FROM [lib://CMS/OPPR_ALL_DTL_RSRCH_12192014.csv]
(txt, codepage is 1252, embedded labels, delimiter is ',', msq);


///$tab Physician
Qualify *;
Unqualify 'Physician_Profile_ID';

Physicians:
LOAD
    Physician_ID,
    Physician_Profile_ID,
    Physician_Profile_First_Name,
    Physician_Profile_Middle_Name,
    Physician_Profile_Last_Name,
    Physician_Profile_Suffix_Name,
    Physician_Profile_Address1,
    Physician_Profile_Address2,
    Physician_Profile_City,
    Physician_Profile_State,
    Physician_Profile_Zip_Code,
    Physician_Profile_Country,
    Physician_Profile_Province,
    Physician_Registration_Address1,
    Physician_Registration_Address2,
    Physician_Registration_City,
    Physician_Registration_State,
    Physician_Registration_Zip_Code,
    Physician_Registration_Country,
    Physician_Registration_Province,
    Physician_Specialty,
    Physician_Additional_Specialty1,
    Physician_Additional_Specialty2,
    Physician_Additional_Specialty3,
    Physician_Additional_Specialty4,
    Physician_Additional_Specialty5,
    Physician_States_on_Licenses1,
    Physician_States_on_Licenses2,
    Physician_States_on_Licenses3,
    Physician_States_on_Licenses4,
    Physician_States_on_Licenses5
FROM [lib://CMS/OPPR_SPLMTL_PH_PRFL_12192014.csv]
(txt, utf8, embedded labels, delimiter is ',', msq);

