///$tab Main
SET ThousandSep=',';
SET DecimalSep='.';
SET MoneyThousandSep=',';
SET MoneyDecimalSep='.';
SET MoneyFormat='$#,##0.00;($#,##0.00)';
SET TimeFormat='h:mm:ss TT';
SET DateFormat='M/D/YYYY';
SET TimestampFormat='M/D/YYYY h:mm:ss[.fff] TT';
SET MonthNames='Jan;Feb;Mar;Apr;May;Jun;Jul;Aug;Sep;Oct;Nov;Dec';
SET DayNames='Mon;Tue;Wed;Thu;Fri;Sat;Sun';
SET LongMonthNames='January;February;March;April;May;June;July;August;September;October;November;December';
SET LongDayNames='Monday;Tuesday;Wednesday;Thursday;Friday;Saturday;Sunday';
SET FirstWeekDay=6;
SET BrokenWeeks=1;
SET ReferenceDay=0;
SET FirstMonthOfYear=1;
///$tab Products
Products:
LOAD
    Product_Id,
    Products,
    "Flag Qlikazine",
    "Flag Qlikastat",
    "Qlik Brands"
FROM [lib://Pharma Sales/Products.qvd]
(qvd);

QlikBrands:
LOAD
    "Qlik Brands",
    "Qlik Brands Name"
FROM [lib://Pharma Sales/QlikBrands.qvd]
(qvd);

Rxs:
LOAD
    RxFactId,
    Product_Id,
    NRx,
    TRx
FROM [lib://Pharma Sales/Rxs.qvd]
(qvd);
Markets:
LOAD
    Market_Id,
    Product_Id,
    Markets
FROM [lib://Pharma Sales/Markets.qvd]
(qvd);
///$tab HCPs
Physicians:
LOAD
    PersonId,
    Doctor as HCP,
    Address,
    City,
    ST,
    Zip,
    "Mapped Target Status",
    latitude,
    longitude,
    "Prescriber Count",
    AddYears("Max Visit Weeks", 7) as "Max Visit Weeks",
    "Market Decile",
    "Qlikazine Decile",
    "Prod. Decile",
    If("Decile Category"='Non-Writer', Dual("Decile Category", 1),
    	If("Decile Category"='Lost Writer', Dual("Decile Category", 2),
        If("Decile Category"='New Writer', Dual("Decile Category", 3),
        If("Decile Category"='Dabbler', Dual("Decile Category", 4),
        If("Decile Category"='Writer', Dual("Decile Category", 5),
        If("Decile Category"='Loyalist', Dual("Decile Category", 6))))))) as "Decile Category",
    "Call Priority",
    "Call Priority Sort",
    "Last Visit Weeks"
FROM [lib://Pharma Sales/Physicians.qvd]
(qvd);

GeoPoint:
LOAD
    PersonId,
    MakePoint
FROM [lib://Pharma Sales/GeoPoint.qvd]
(qvd);
///$tab Visits
Visits:
LOAD
    CallFactId,
    _D,
    _SA,
    _SE,
    _SXA
FROM [lib://Pharma Sales/Visits.qvd]
(qvd);
///$tab Call Priorities
[Call Priorities]:
LOAD
    "Call Priority"
FROM [lib://Pharma Sales/Call Priorities.qvd]
(qvd);
///$tab Employees
Employees:
LOAD
    "Regional Director",
    "Territory Manager",
    "Territory Number"
FROM [lib://Pharma Sales/Employees.qvd]
(qvd);
///$tab Metric Rxs
[Metric Rxs]:
LOAD
    "Rx Metrics",
    "Rx Metric Value"
FROM [lib://Pharma Sales/Metric Rxs.qvd]
(qvd);
///$tab LinkTable
LinkTable:
LOAD
    PersonId,
    FactId,
    RxFactId,
    CallFactId,
    "Territory Number",
    AddYears(Weeks, 7) as Weeks
FROM [lib://Pharma Sales/Link Table.qvd]
(qvd);
///$tab Calendar
Weeks1:
LOAD
    AddYears("Date", 7) as Weeks,
    AddYears("Date", 7) as "Date",
    Year(AddYears("Date", 7)) as "Year",
	Dual('Q'&Num(Ceil(Num(Month(AddYears("Date", 7)))/3)),Num(Ceil(NUM(Month(AddYears("Date", 7)))/3),00)) as Quarter,
    Month(AddYears("Date", 7)) as "Month",
    Date#(Month(AddYears("Date", 7))&'-'&Year(AddYears("Date", 7)), 'MMM-YYYY') as MonthYear
FROM [lib://Pharma Sales/Weeks1.qvd]
(qvd);