///$tab Main
SET ThousandSep=',';
SET DecimalSep='.';
SET MoneyThousandSep=',';
SET MoneyDecimalSep='.';
SET MoneyFormat='$#,##0.00;-$#,##0.00';
SET TimeFormat='h:mm:ss TT';
SET DateFormat='M/D/YYYY';
SET TimestampFormat='M/D/YYYY h:mm:ss[.fff] TT';
SET FirstWeekDay=6;
SET BrokenWeeks=1;
SET ReferenceDay=0;
SET FirstMonthOfYear=1;
SET CollationLocale='en-US';
SET CreateSearchIndexOnReload=1;
SET MonthNames='Jan;Feb;Mar;Apr;May;Jun;Jul;Aug;Sep;Oct;Nov;Dec';
SET LongMonthNames='January;February;March;April;May;June;July;August;September;October;November;December';
SET DayNames='Mon;Tue;Wed;Thu;Fri;Sat;Sun';
SET LongDayNames='Monday;Tuesday;Wednesday;Thursday;Friday;Saturday;Sunday';
SET NumericalAbbreviation='3:k;6:M;9:G;12:T;15:P;18:E;21:Z;24:Y;-3:m;-6:Î¼;-9:n;-12:p;-15:f;-18:a;-21:z;-24:y';




///$tab Mapping
TeamNames:
Mapping Load * Inline [
TeamId, TeamName
1,Delusional Demons
2,New Justice Team
3,El Profeta
4,Varnhem Gargantuans
5,Lund Cork Eaters
6,The Bad Lip Read Loggers
7,Pavelsgard Butchers
8,The Badass BrownViking
9,Tiki Taka Juice Decks
10,Team Gmerica
11,Old North Pale Faces
12,Polk High
];

TeamNames2:
Mapping Load * Inline [
TeamId, TeamName
1,Delusional Demons
2,New Justice Team
3,El Profeta
4,Varnhem Gargantuans
5,Lund Cork Eaters
6,The Bad Lip Read Loggers
7,Pavelsgard Butchers
8,The Badass BrownViking
9,Tiki Taka Juice Decks
10,Team Gmerica
11,Old North Pale Faces
12,Polk High
];

TeamRank:
Mapping Load * Inline [
TeamId, TeamName
1,9
2,10
3,1
4,11
5,7
6,3
7,4
8,8
9,2
10,12
11,5
12,6
];
///$tab Teams2022
Teams2022:
Load *
From [Lib://QVD/Teams2022.qvd](qvd); 
///$tab TeamOverall
TeamTemp:
Load Distinct TeamId, TeamName, ApplyMap('TeamRank',TeamId) AS TeamRank
Resident Teams2022;

Team:
NoConcatenate Load * Resident TeamTemp
Order by TeamRank asc;

Drop Field TeamId From Team; 
Drop Table TeamTemp;

//Exit Script;
///$tab Games2022
Games2022:
Load *, If(Games.FantasyPts > 15, 1,0) AS Flg15PtGame
From [Lib://QVD/Games2022.qvd](qvd); 
///$tab Team2022RostersGen
Exit Script; 

LET vTeam = 1;

Teams2022Temp:
Load * Inline [ 
TeamId,Pos,Action,Player,Opp,Status,PassingYds,PassingTD,PassingInt2,RushingYds,Rushing1TD,ReceivingReceptions,ReceivingYds,ReceivingTD2,RetTD,OffensiveFumTD,2Pt,Fum,FantasyPts,PATMade,PATMiss,FG Made0-19,FG Made20-29,FG Made30-392,FG Made40-493,FG Made50+4,FG Miss0-19,FG Miss20-29,FG Miss30-39,Tackles,TacklesAsst,Sacks,TacklesForLoss,TurnoverInt,TurnoverFFum,TurnoverFumRec,IntTD,FumTD,BlkTD,Saf,Def2ptRet,Blk,PDef,QBHit,IntYds,FumYds
];


// Define your initial variable value



// Create a recursive loop using a LOAD statement
FOR i = 1 TO 12
Let vTeamHistoryConnection = 'https://fantasy.nfl.com/league/1014629/history/2022/teamhome?teamId=$(vTeam)';
Trace i = $(i);
Trace $(vTeamHistoryConnection);
Offense:
Concatenate(Teams2022Temp) LOAD
	$(i) AS TeamId,
    F1 AS "Pos",
    F2 AS Action,
    F3 AS Player,
    F4 AS Opp,
    F5 AS Status,
    Passing AS PassingYds,
    Passing1 AS PassingTD,
    Passing2 AS PassingInt2,
    Rushing AS RushingYds,
    Rushing1 AS Rushing1TD,
    Receiving AS ReceivingReceptions,
    Receiving1 AS ReceivingYds,
    Receiving2 AS ReceivingTD2,
    Ret AS RetTD,
    Misc AS FumTD,
    Misc1 AS "2Pt",
    Fum,
    Fantasy AS FantasyPts   
FROM $(vTeamHistoryConnection)
(html, codepage is 28591, embedded labels, table is @1)
where RecNo() >1 and [F1] <> 'Bench';


Special:
Outer Join(Teams2022Temp) LOAD
    $(i) AS TeamId,
    F1 AS "Pos",
    F2 AS Action,
    F3 AS Player,
    F4 AS Opp,
    F5 AS Status,
    PAT AS PATMade,
    PAT1 AS PATMiss,
    "FG Made" AS "FG Made0-19",
    "FG Made1" AS "FG Made20-29",
    "FG Made2" AS "FG Made30-392",
    "FG Made3" AS "FG Made40-493",
    "FG Made4" AS "FG Made50+4",
    "FG Miss" AS "FG Miss0-19",
    "FG Miss1" AS "FG Miss20-29",
    "FG Miss2" AS "FG Miss30-39",
    Fantasy AS FantasyPts
FROM $(vTeamHistoryConnection)
(html, codepage is 28591, embedded labels, table is @2)
where RecNo() >1 and [F1] <> 'Bench';


Defense:
Outer Join(Teams2022Temp) LOAD
	$(i) AS TeamId,
    F1 AS "Pos",
    F2 AS Action,
    F3 AS Player,
    F4 AS Opp,
    F5 AS Status,
    Tackles,
    Tackles1 AS TacklesAsst,
    Tackles2 AS Sacks,
    Tackles3 AS TacklesForLoss,
    Turnover AS TurnoverInt,
    Turnover1 AS TurnoverFFum,
    Turnover2 AS TurnoverFumRec,
    Score AS IntTD,
    Score1 AS FumTD,
    Score2 AS BlkTD,
    Score3 AS Saf,
    Score4 AS Def2ptRet,
    Other AS Blk,
    Other1 AS PDef,
    Other2 AS QBHit,
    Return AS IntYds,
    Return1 AS FumYds,
    Fantasy AS FantasyPts
FROM $(vTeamHistoryConnection)
(html, codepage is 28591, embedded labels, table is @3)
where RecNo() >1 and [F1] <> 'Bench';
// LET vTeam = $(vTeam) + 1;
  If $(vTeam) <12 Then 
 	vTeam = $(vTeam) + 1 
    End If;
Next;
//Exit script; 
Teams2022:
NoConcatenate Load *, ApplyMap('TeamNames',TeamId) AS TeamName
Resident Teams2022Temp; 

Drop Table Teams2022Temp;

Store Teams2022 Into [Lib://QVD/Teams2022.qvd](qvd);
///$tab Team2022Games
Exit Script;

Games2022:
Load * Inline [
TeamId,Games.Week,Games.Pos,Games.Player,Games.Opp,Games.Status,Games.Stats,Games.FantasyPts
];
Qualify *;
Unqualify TeamId;

LET vTeam = 1;
LET vWeek = 1;

FOR i = 1 TO 12
	LET vWeek = 1;
	For j = 1 TO 17
Let vGameHistoryConnection = 'https://fantasy.nfl.com/league/1014629/history/2022/teamgamecenter?teamId=$(vTeam)&week=$(vWeek)';
Trace i = $(i);
Trace j = $(j);
Trace $(vGameHistoryConnection);

Games:
Concatenate(Games2022) LOAD
	$(i) AS TeamId,
    $(j) AS Week,
    F1 AS "Pos",
    F2 AS Player,
    F3 AS Opp,
    F4 AS Status,
    F5 AS Stats,
 //   SubField(F5, ',') As Stats2,
    Fantasy AS FantasyPts
FROM $(vGameHistoryConnection) //[lib://FF2 (centrify_michaelterenzi)]
(html, codepage is 28591, embedded labels, table is @1)
where RecNo() >1;

Concatenate(Games2022) LOAD
	$(i) AS TeamId,
    $(j) AS Week,
    F1 AS "Pos",
    F2 AS Player,
    F3 AS Opp,
    F4 AS Status,
    F5 AS Stats,
 //   SubField(F5, ',') As Stats2,
    Fantasy AS FantasyPts
FROM [lib://FF2 (centrify_michaelterenzi)]
(html, codepage is 28591, embedded labels, table is @2)
where RecNo() >1;

	If $(vWeek) <17 Then 
 	vWeek = $(vWeek) + 1 
    Trace HERE is your week: $(vWeek);
    	End If;
	Next;
 		If $(vTeam) <12 Then 
 		vTeam = $(vTeam) + 1
 		End If;
        
   Next;
Store Games2022 Into [Lib://QVD/Games2022.qvd](qvd);   
